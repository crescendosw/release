{"version":3,"sources":["shared.ts","util/instrument.ts","MidiPlaybackEnvironment.tsx","assets/library-books.svg","pages/header.tsx","pages/footer.tsx","util/useWindowDimensions.ts","pages/info_page.tsx","pages/player_page.tsx","pages/hymns_list.tsx","data/settings.ts","pages/choose_church_page.tsx","index.tsx","pages/this_week_page.tsx","pages/library_page.tsx","pages/help_page.tsx"],"names":["hymnalsPath","process","hymnalsPDFPath","ensure","value","message","Error","ensureExists","getHymnFromUrl","search","url","URLSearchParams","hymnTitle","get","hymnNumber","num","size","length","pad","hymnalName","correctedHymnTitle","replace","correctedHymnalName","psalmName","hymnal","title","number","psalm","mp3Buffers","loadCallbacks","loadInitiated","loadInstrument","callback","push","loadSoundfont","createAudioContext","window","AudioContext","webkitAudioContext","playNote","audioContext","noteName","gain","when","buffer","source","createBufferSource","gainNode","createGain","connect","destination","setValueAtTime","start","gainValue","stopNote","exponentialRampToValueAtTime","fetch","then","response","ok","status","statusText","arrayBuffer","soundFont","soundFontLength","byteLength","dataView","DataView","bufferCount","getUint32","currentOffset","promises","TextDecoder","decode","trim","bufferLength","slice","decodeAudioData","buffer_index","Promise","all","results","Voice","MidiPlaybackEnvironment","props","initialTempo","initialTime","songLength","interval","activeNotes","midiPlayer","mostRecentTick","mostRecentTime","silentNode","mostRecentTempoChangeTime","tempoTimer","audio","state","playing","instrumentIsLoaded","midiFileLoaded","experiencingUserInputOnTimeSlider","_handleEvent","bind","_playPause","_pause","_play","_getTempoValue","_setNewTime","_setNewTempo","_displayTempo","_onTempoChange","_displayTime","_onEndOfFile","_updateTimeSlider","MidiPlayer","Player","on","Date","now","_loadMidiFile","this","undefined","pause","setTimeout","skipToPercent","play","Number","tempoSliderElement","document","getElementById","setState","timeSliderElement","isPlaying","timeOutputElement","secondsSelected","innerHTML","_getTimeValue","newTempo","getTempo","setTempo","msSinceLastTempoChange","clearTimeout","Math","max","round","toString","abs","getSongPercentRemaining","currentTime","_getCurrentPercent","_finishedLoading","event","tick","name","voice","channel","Soprano","Alto","Tenor","Bass","velocity","_getVoiceValue","_stopSilence","createOscillator","type","frequency","silentGain","stop","addEventListener","visibilityState","endOfFile","_startSilence","Audio","close","src","midiFilePath","loadArrayBuffer","getSongTime","id","className","Object","values","map","charAt","toUpperCase","_sliderName","defaultValue","min","step","onInput","onPointerUp","hidden","onClick","_getTimeOutput","setInterval","global","ringerOn","ringerOff","clearInterval","secondsElapsed","trunc","padStart","React","Component","_g","_g2","_g3","_g4","_g5","_g6","_g7","_g8","_g9","_g10","_g11","_g12","_g13","_g14","_g15","_g16","_g17","_g18","_g19","Header","goBack","useCallback","back","history","backButton","to","parentUrl","_excluded","_extends","assign","target","i","arguments","key","prototype","hasOwnProperty","call","apply","_objectWithoutProperties","excluded","sourceKeys","keys","indexOf","_objectWithoutPropertiesLoose","getOwnPropertySymbols","sourceSymbolKeys","propertyIsEnumerable","SvgLibraryBooks","_ref","svgRef","titleId","xmlnsXlink","xmlns","x","y","viewBox","style","enableBackground","xmlSpace","ref","d","width","height","transform","ForwardRef","Footer","getWindowDimensions","innerWidth","innerHeight","InfoPage","txtFilePath","useState","songText","setSongText","useEffect","text","data","lines","split","author","filter","line","startsWith","match","composer","harmony","copyright","PlayerPage","generateFileName","hymn","fileType","includes","encodeMusicURI","uri","encodeURIComponent","generatePathFor","fileName","Display","useLocation","SongSettings","display","setDisplay","numPages","setNumPages","windowDimensions","setWindowDimensions","handleResize","removeEventListener","useWindowDimensions","midiFile","hymns","pdfFile","txtFile","pdfPath","PDF","file","options","workerSrc","onLoadSuccess","onLoadError","console","error","Array","page","pageNumber","Info","HymnsList","expandedHymnals","setExpandedHymnals","searchString","setSearchString","hymnalNames","setHymnalNames","allHymnals","setAllHymnals","searchHasFocus","setSearchHasFocus","displayHymn","setDisplayHymn","hymnalsManifest","json","hymnalManifest","responses","hymnLists","searchRegEx","useMemo","searchTerms","replaceAll","RegExp","prependZeros","generateSongDisplayName","psalmSuffix","toLowerCase","displayName","startIndex","endIndex","beforeBold","bold","afterBold","generateHTMLTable","tableRows","generateUrl","handleClick","showSongs","collapsed","cancelSearch","placeholder","onChange","onFocus","onBlur","autoComplete","hymnals","defaultHymnals","renderHymnals","settings","cookies","cookie","groups","decodeURI","date","setTime","getTime","encodeURI","toUTCString","ChooseChurchPage","churchesManifest","churches","setChurches","church","setChurch","onSetChurch","currentTarget","catch","cancelChurchSearch","regEx","churchesFiltered","churchesRendered","churchName","defaultChecked","navigator","serviceWorker","register","registration","log","scope","err","hasBeenCaught","filename","lineno","column","colno","JSON","stringify","webkit","messageHandlers","postMessage","ReactDOM","render","basename","exact","path","component","thisWeekManifest","setHymnals","downloadFinished","setDownloadFinished","sundayDay","setSundayDay","churchManifest","isOldDataFormat","from","Set","today","result","setDate","getDate","getDay","getMonth","thisSundayDate","songs","href"],"mappings":"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","file":"static/js/main.0bdb6ddc.chunk.js","sourcesContent":["import {Hymn} from \"./pages/hymns_list\";\n\nexport const hymnalsPath = process.env.PUBLIC_URL + '/hymnals';\nexport const hymnalsPDFPath = process.env.PUBLIC_URL + '/hymnals';\n\nexport function ensure(value: boolean, message: string): void {\n  if (!value) {\n    throw new Error(message);\n  }\n}\n\nexport function ensureExists<T>(value: T | undefined | null): T {\n  if (typeof(value) === 'undefined' || value === null) {\n    throw new Error('Expected value to be defined and not null');\n  }\n  return value;\n}\n\nconst pad = (num: string | null, size: number) => {\n  if (num === null) {\n    return\n  }\n  while (num.length < size) num = \"0\" + num;\n  return num;\n};\n\nexport function getHymnFromUrl(search: string): Hymn | undefined{\n  const url = new URLSearchParams(search);\n  const hymnTitle = url.get('title');\n  const hymnNumberUnpadded = url.get('number');\n  const hymnNumber = pad(hymnNumberUnpadded, 3)\n  const hymnalName = url.get('hymnal');\n  let hymn: Hymn;\n\n  if(hymnTitle && hymnNumber && hymnalName) {\n    const correctedHymnTitle = hymnTitle.replace(/_/g, ' ');\n    const correctedHymnalName = hymnalName.replace(/_/g, ' ');\n    const psalmName = url.get('psalm');\n\n    if(psalmName) {\n      const correctedPsalmName = psalmName.replace(/_/g, ' ');\n\n      hymn = {\n        hymnal: correctedHymnalName,\n        title: correctedHymnTitle,\n        number: hymnNumber,\n        psalm: correctedPsalmName\n      };\n    } else {\n      hymn = {\n        hymnal: correctedHymnalName,\n        title: correctedHymnTitle,\n        number: hymnNumber\n      };\n    }\n  } else {\n    return undefined\n  }\n  return hymn;\n}\n","import {ensure, ensureExists} from \"../shared\";\n\nconst soundFontPath = process.env.PUBLIC_URL + '/sound-font.bin';\nconst loadCallbacks: (() => void)[] = [];\nlet loadInitiated = false;\nlet mp3Buffers: {[noteName: string]: AudioBuffer} | undefined;\n\nexport function loadInstrument(callback: () => void): void {\n  if (mp3Buffers) {\n    callback();\n  } else {\n    loadCallbacks.push(callback);\n    loadSoundfont();\n  }\n}\n\nexport function createAudioContext(): AudioContext {\n  return new (window.AudioContext || (window as any).webkitAudioContext)();\n}\n\nexport interface ActiveNote {\n  gainNode: GainNode,\n  gainValue: number,\n}\n\n/**\n * must call loadInstrument first and wait for the callback before calling playNote\n */\nexport function playNote(audioContext: AudioContext, noteName: string, gain: number, when: number): ActiveNote {\n  ensure(noteName in ensureExists(mp3Buffers), `Note \"${noteName}\" not found in mp3_buffers`);\n  const buffer = ensureExists(mp3Buffers)[noteName];\n  const source = audioContext.createBufferSource();\n  const gainNode = audioContext.createGain();\n  source.buffer = buffer;\n  source.connect(gainNode);\n  gainNode.connect(audioContext.destination);\n  gainNode.gain.setValueAtTime(gain, when);\n  source.start(when);\n  return {gainNode, gainValue: gain};\n}\n\nexport function stopNote({gainNode, gainValue}: ActiveNote, when: number): any {\n  if (gainValue > 0) {\n    // quick fade better than sudden stop (causes pop if stopping sign wave at non-zero location)\n    // fade begins at previous event (which explains the duplicate setValueAtTime)\n    gainNode.gain.setValueAtTime(gainValue, when);\n    gainNode.gain.exponentialRampToValueAtTime(0.0001, when + 1 / 8);\n  }\n}\n\nexport function loadSoundfont() {\n  if (!loadInitiated) {\n    loadInitiated = true;\n    fetch(soundFontPath)\n      .then((response) => {\n        if (!response.ok) {\n          loadInitiated = false;\n          throw new Error(`failed to load sound font ${response.status}, ${response.statusText}`)\n        }\n        return response.arrayBuffer()})\n      .then((soundFont: ArrayBuffer) => {\n        const audioContext = createAudioContext();\n        const soundFontLength = soundFont.byteLength;\n        const dataView = new DataView(soundFont);\n        const bufferCount = dataView.getUint32(0);\n        const noteNameSize = 4;\n        const uint32Size = 4;\n        var currentOffset = uint32Size;\n        const promises = [];\n        for (var buffer_index = 0; buffer_index < bufferCount; buffer_index++) {\n          const noteName = new TextDecoder().decode(new DataView(soundFont, currentOffset, noteNameSize)).trim()\n          currentOffset += noteNameSize;\n          const bufferLength = dataView.getUint32(currentOffset);\n          currentOffset += uint32Size;\n          const buffer = soundFont.slice(currentOffset, currentOffset + bufferLength);\n          promises.push(audioContext.decodeAudioData(buffer).then((buffer) => {\n            return {noteName, buffer};\n          }));\n          currentOffset += bufferLength;\n          ensure(currentOffset <= soundFont.byteLength,\n            `Expected currentOffest (${currentOffset}) <= soundFontLength (${soundFontLength})`);\n        }\n        Promise.all(promises).then((results) => {\n          mp3Buffers = {};\n          for (const {noteName, buffer} of results) {\n            mp3Buffers[noteName] = buffer;\n          }\n          for (const callback of loadCallbacks) {\n            callback();\n          }\n          loadCallbacks.length = 0;\n        });\n      })\n  }\n}\n","import React from 'react';\nimport MidiPlayer from 'midi-player-js';\nimport './MidiPlaybackEnvironment.css';\nimport {AiOutlinePauseCircle, AiOutlinePlayCircle} from \"react-icons/all\";\nimport {ActiveNote, createAudioContext, loadInstrument, playNote, stopNote} from './util/instrument';\nimport {ensureExists} from \"./shared\";\n\nenum Voice {\n  Soprano = 'soprano',\n  Alto = 'alto',\n  Tenor = 'tenor',\n  Bass = 'bass',\n}\n\ninterface Props {\n  midiFilePath: string;\n}\n\ninterface State {\n  playing: boolean;\n  initialTempo: string;\n  initialTime: string;\n  songLength: number;\n  instrumentIsLoaded: boolean;\n  midiFileLoaded: boolean;\n  experiencingUserInputOnTimeSlider: boolean;\n}\n\n// todo(hewitt): remove once the iOS app is no longer calling\ndeclare global {\n  function ringerOn(): void;\n  function ringerOff(): void;\n}\n\nconst msBetweenTempoChanges = 500;\n\nexport class MidiPlaybackEnvironment extends React.Component<Props, State> {\n  initialTempo: string | undefined;\n  initialTime: string | undefined;\n  songLength: number | undefined;\n  interval: number | undefined;\n  activeNotes: { [channel: number]: ActiveNote } = {};\n  midiPlayer: MidiPlayer.Player;\n  mostRecentTick: number | undefined;\n  mostRecentTime: number | undefined;\n  audioContext = createAudioContext();\n  silentNode: OscillatorNode | undefined;\n  mostRecentTempoChangeTime: number;\n  tempoTimer: NodeJS.Timeout | undefined;\n  audio?: HTMLAudioElement;\n\n  constructor(props: Props) {\n    super(props);\n\n    this.state = {\n      playing: false,\n      initialTempo: '',\n      initialTime: '0:00',\n      songLength: 0,\n      instrumentIsLoaded: false,\n      midiFileLoaded: false,\n      experiencingUserInputOnTimeSlider: false,\n    };\n\n    this._handleEvent = this._handleEvent.bind(this);\n    this._playPause = this._playPause.bind(this);\n    this._pause = this._pause.bind(this);\n    this._play = this._play.bind(this);\n    //this._loadMidiFile = this._loadMidiFile.bind(this);\n    this._getTempoValue = this._getTempoValue.bind(this);\n    this._setNewTime = this._setNewTime.bind(this);\n    this._setNewTempo = this._setNewTempo.bind(this);\n    this._displayTempo = this._displayTempo.bind(this);\n    this._onTempoChange = this._onTempoChange.bind(this);\n    this._displayTime = this._displayTime.bind(this);\n    this._onEndOfFile = this._onEndOfFile.bind(this);\n    this._updateTimeSlider = this._updateTimeSlider.bind(this);\n    this.midiPlayer = new MidiPlayer.Player(this._handleEvent);\n    this.midiPlayer.on('endOfFile', this._onEndOfFile);\n    this.mostRecentTempoChangeTime = Date.now();\n    this._loadMidiFile();\n  }\n  private _onEndOfFile(): void {\n    this.mostRecentTick = undefined;\n    // restart player from the start if we encounter the end of the file while playing\n    if (this.state.playing) {\n      this.midiPlayer.pause();\n      setTimeout(() => {\n        // user may have paused the player at the end of the song, in which case we don't want to restart it\n        if (this.state.playing) {\n          this.midiPlayer.skipToPercent(0);\n          this.midiPlayer.play();\n          this._updateTimeSlider();\n        }\n      }, 100);\n    }\n  }\n\n  private static _getVoiceValue(voice: Voice): number {\n    const slider = ensureExists(document.getElementById(MidiPlaybackEnvironment._sliderName(voice)));\n    let value = (slider as HTMLInputElement).value;\n    return Number(value);\n  }\n\n  private static _sliderName(voice: Voice): string {\n    return `${voice}-slider`;\n  }\n\n  private static _getTimeValue(secondsElapsed: number): string {\n    const minutes = Number(Math.trunc(secondsElapsed / 60));\n    const seconds = (Math.trunc(secondsElapsed % 60)).toString().padStart(2,'0');\n    return minutes + ':' + seconds;\n  }\n\n  private _getTempoValue(): number {\n    const initialTempo = Number(this.state.initialTempo);\n    const tempoSliderElement = document.getElementById('tempo-slider');\n    const currentTempo = Number((tempoSliderElement as HTMLInputElement).value);\n    return currentTempo * initialTempo;\n  }\n\n  private _setNewTime(): void {\n    this.setState({experiencingUserInputOnTimeSlider: false});\n    const timeSliderElement = document.getElementById('time-slider');\n\n    if (this.midiPlayer.isPlaying()) {\n      this.midiPlayer.skipToPercent(Number((timeSliderElement as HTMLInputElement).value));\n      this.midiPlayer.play();\n    }\n    else {\n      this.midiPlayer.skipToPercent(Number((timeSliderElement as HTMLInputElement).value));\n    }\n  }\n\n  private _displayTime(): void {\n    this.setState({experiencingUserInputOnTimeSlider: true});\n    const timeSliderElement = document.getElementById('time-slider');\n    const timeOutputElement = document.getElementById('time-output');\n    let secondsSelected = ((Number((timeSliderElement as HTMLInputElement).value) / 100) * this.state.songLength);\n\n    (timeOutputElement as HTMLOutputElement).innerHTML = MidiPlaybackEnvironment._getTimeValue(secondsSelected);\n  }\n\n  private _setNewTempo(): void {\n    const newTempo = this._getTempoValue();\n    if (this.midiPlayer.getTempo() !== newTempo) {\n      this.midiPlayer.setTempo(newTempo);\n    }\n    this.mostRecentTempoChangeTime = Date.now();\n  }\n\n  private _onTempoChange(): void {\n    this._displayTempo();\n    const msSinceLastTempoChange = Date.now() - this.mostRecentTempoChangeTime;\n    if (this.tempoTimer) {\n      clearTimeout(this.tempoTimer);\n    }\n    this.tempoTimer = setTimeout(this._setNewTempo, Math.max(0, msBetweenTempoChanges - msSinceLastTempoChange));\n  }\n\n  private _displayTempo(): void {\n    const tempoOutputElement = document.getElementById('tempo-output');\n    (tempoOutputElement as HTMLInputElement).innerHTML = (Math.round(this._getTempoValue())).toString();\n  }\n\n  private get _finishedLoading(): boolean {\n    return this.state.instrumentIsLoaded && this.state.midiFileLoaded;\n  }\n\n  private _getCurrentPercent(): number {\n    return Math.abs(100 - this.midiPlayer.getSongPercentRemaining());\n  }\n\n  private _getTimeOutput(): string {\n    let currentTime = (this._getCurrentPercent() / 100) * this.state.songLength;\n\n    if (this._finishedLoading) {\n      return MidiPlaybackEnvironment._getTimeValue(currentTime);\n    }\n    else {\n      return 'LOADING'\n    }\n  }\n\n  private _handleEvent(event: any): void {\n    let gain: number = 100;\n    const divisor = 250;\n\n    // The mostRecentTick & mostRecentTime allow us to schedule all notes with the same tick\n    // to play at the same time, 1/4 second in the future.  That way, even if the foreground\n    // thread gets busy, the notes are already scheduled to play at exactly the same time,\n    // so there will be no delay between any two notes unless the foreground thread is so busy\n    // that it cannot service the next note for over 1/4 second.\n    //\n    // However, we can do better - we can make the tempo consistent as well.\n    // What we need to know is what the current tick means in terms of AudioContext.currentTime\n    // That way, the tempo will remain consistent even if the foreground thread becomes busy\n    // because are always scheduling the next note 1/4 second in the future for the exact right\n    // moment, so as long as the code doesn't get more than 1/4 second behind in scheduling, the\n    // tempo will be consistent.\n    // The trick here is to consistently relate the current tick to the AudioContext.currentTime\n    // in the face of a changing tempo & song location.\n    // const songTime = (event.tick / this.midiPlayer.getTotalTicks()) * this.midiPlayer.getSongTime();\n\n    var when: number;\n    if (this.mostRecentTick === event.tick) {\n      when = this.mostRecentTime!;\n    } else {\n      this.mostRecentTick = event.tick;\n      when = this.mostRecentTime = this.audioContext.currentTime + 1/4;\n    }\n\n    if (event.name === 'Note on' && this.state.playing) {\n      let voice: Voice;\n      switch (event.channel) {\n        default:\n        case 1: voice = Voice.Soprano; break;\n        case 2: voice = Voice.Alto; break;\n        case 3: voice = Voice.Tenor; break;\n        case 4: voice = Voice.Bass; break;\n      }\n      gain = event.velocity * (MidiPlaybackEnvironment._getVoiceValue(voice) / divisor);\n\n      if (this.activeNotes[event.channel]) {\n        stopNote(this.activeNotes[event.channel], when);\n      }\n\n      if (gain > 0) {\n        this.activeNotes[event.channel] = playNote(this.audioContext, event.noteName, gain, when);\n      }\n    }\n    else if (event.name === 'Note off') {\n      if (this.activeNotes[event.channel]) {\n        stopNote(this.activeNotes[event.channel], when);\n        delete this.activeNotes[event.channel];\n      }\n    }\n  }\n\n  /*private _loadMidiFile(): void {\n    if (!this.audioContext) {\n      this.audioContext = new AudioContext();\n      const instrumentName = window.navigator.userAgent.includes('Mobile') ?\n        'acoustic_grand_piano-mp3.js' : 'acoustic_grand_piano-ogg.js';\n      //@ts-ignore\n      SoundFont.instrument(this.audioContext, instrumentName).then(this._instrumentLoaded);\n    }\n  }*/\n\n  // On iOS, we must begin playing a note right away when the play button is pressed\n  // Thus, we play a silent note for the duration of the song - until pause is clicked\n  private _startSilence(): void {\n    this._stopSilence();\n    this.silentNode = this.audioContext.createOscillator();\n    this.silentNode.type = 'sine';\n    this.silentNode.frequency.setValueAtTime(200, this.audioContext.currentTime);\n    const silentGain = this.audioContext.createGain();\n    silentGain.gain.setValueAtTime(0, this.audioContext.currentTime);\n    silentGain.connect(this.audioContext.destination);\n    this.silentNode.connect(silentGain);\n    this.silentNode.start();\n  }\n\n  private _stopSilence(): void {\n    if (this.silentNode) {\n      this.silentNode.stop();\n      this.silentNode = undefined;\n    }\n  }\n\n\n  private _playPause(): void {\n    if (this._finishedLoading) {\n      if (!this.state.playing) {\n        this._play()\n        document.addEventListener('visibilitychange', () => {\n          if (document.visibilityState === 'hidden') {\n            this._pause()\n          }\n        })\n      } else {\n        this._pause()\n      }\n    }\n  }\n\n  private _play({endOfFile}: {endOfFile?: boolean} = {}): void {\n    this.setState({playing: true});\n    if (!endOfFile) {\n      this.audioContext = createAudioContext();\n      this._startSilence();\n    }\n\n    this.mostRecentTick = undefined;\n    this.midiPlayer.play();\n\n    this.audio = new Audio('../silence250ms.mp3')\n    this.audio.play()\n  }\n\n  private _pause({endOfFile}: {endOfFile?: boolean} = {}): void {\n    if (this.state.playing) {\n      this.audioContext.close()\n    }\n\n    if (!endOfFile) {\n      this.midiPlayer.pause();\n    }\n\n    this._stopSilence();\n    this.setState({playing: false});\n\n    if (this.audio) {\n      this.audio.src = '';\n    }\n  }\n\n  private _loadMidiFile() {\n\n    const loadArrayBuffer = (buffer: ArrayBuffer) => {\n      this.midiPlayer.loadArrayBuffer(buffer);\n      this.setState({initialTempo: this.midiPlayer.getTempo().toString()});\n      this.setState({songLength: this.midiPlayer.getSongTime()});\n      this.setState({initialTime: '0:00'});\n      this.setState({midiFileLoaded: true});\n    }\n\n    fetch(this.props.midiFilePath)\n        .then(response => response.arrayBuffer())\n        .then(buffer => loadArrayBuffer(buffer));\n  }\n\n  render() {\n    return (\n        <div>\n          <form id = 'slider-form'>\n            <table className='sliderTable'>\n              <colgroup>\n                <col className='sliderLabelColumn' />\n              </colgroup>\n              <tbody>\n                {\n                  Object.values(Voice).map(voice => (\n                    <tr key={voice}>\n                      <td>\n                        <label className='sliderLabel' id={`${voice}-label`}>\n                          {voice.charAt(0).toUpperCase() + voice.slice(1)}\n                        </label>\n                      </td>\n                      <td className='sliderCell'>\n                        <input\n                          className={`letter_${voice.charAt(0)}`}\n                          type='range'\n                          id={MidiPlaybackEnvironment._sliderName(voice)}\n                          defaultValue={voice === Voice.Soprano ? 2 : 1}\n                          min={0}\n                          max={2}\n                          step={0.01}\n                        />\n                      </td>\n                    </tr>\n                  ))\n                }\n                <tr>\n                  <td className='tempoCell'>\n                    <label className='sliderLabel' id = 'tempo-label'>Tempo</label><br />\n                    <div className='bpm sliderLabel' id='tempo-output'>{this.state.initialTempo}</div>\n                  </td>\n                  <td className='tempoCell sliderCell'>\n                    <input className='tempo' type = 'range' id ='tempo-slider' defaultValue = {1} min = {0.5} max = {1.5} step = {0.01}\n                      onInput = {this._onTempoChange}/>\n                  </td>\n                </tr>\n                <tr>\n                  <td><label className='sliderLabel' id='time-output'>{this.state.initialTime}</label></td>\n                  <td className='sliderCell'><input className='timeSliderThumb' type='range' id='time-slider' onInput={this._displayTime} onPointerUp={this._setNewTime}\n                             defaultValue={0} min={0} max={100} step={0.01}/></td>\n                </tr>\n              </tbody>\n            </table>\n          </form>\n          <div className='bottomDiv' id='bottom-div'>\n            <label\n              className='loading'\n              id='loading'\n              hidden={this._finishedLoading}>\n              Loading\n            </label>\n            <button\n              id='play-button'\n              className='playPauseButton'\n              hidden={!this._finishedLoading || this.state.playing}\n              onClick={() => this._playPause()} >\n              <AiOutlinePlayCircle className='playPauseIcon' />\n            </button>\n            <button\n              id='pause-button'\n              className='playPauseButton'\n              hidden={!this._finishedLoading || !this.state.playing}\n              onClick={() => this._playPause()} >\n              <AiOutlinePauseCircle className='playPauseIcon' />\n            </button>\n          </div>\n        </div>\n    )\n  }\n\n  private _updateTimeSlider() {\n    if (\n      this._finishedLoading &&\n      this.midiPlayer.isPlaying() &&\n      !this.state.experiencingUserInputOnTimeSlider\n    ) {\n      const timeSliderElement = document.getElementById('time-slider');\n      const timeOutputElement = document.getElementById('time-output');\n      (timeSliderElement as HTMLOutputElement).value = this._getCurrentPercent().toString();\n      (timeOutputElement as HTMLOutputElement).innerHTML = this._getTimeOutput();\n    }\n  }\n\n  componentDidMount() {\n    this.interval = window.setInterval(this._updateTimeSlider, 1000);\n    loadInstrument(() => {\n      this.setState({instrumentIsLoaded: true})\n    });\n\n    // todo(hewitt): remove when the iOS app no longer calls these\n    global.ringerOn = () => {};\n    global.ringerOff = () => {};\n  }\n\n  componentWillUnmount() {\n    global.ringerOn = () => {};\n    global.ringerOff = () => {};\n\n    clearInterval(this.interval);\n\n    // stop music when back button is pressed\n    if (this.state.playing) {\n      this._playPause();\n    }\n  }\n}","var _g, _g2, _g3, _g4, _g5, _g6, _g7, _g8, _g9, _g10, _g11, _g12, _g13, _g14, _g15, _g16, _g17, _g18, _g19;\n\nvar _excluded = [\"title\", \"titleId\"];\n\nfunction _extends() { _extends = Object.assign ? Object.assign.bind() : function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nfunction _objectWithoutProperties(source, excluded) { if (source == null) return {}; var target = _objectWithoutPropertiesLoose(source, excluded); var key, i; if (Object.getOwnPropertySymbols) { var sourceSymbolKeys = Object.getOwnPropertySymbols(source); for (i = 0; i < sourceSymbolKeys.length; i++) { key = sourceSymbolKeys[i]; if (excluded.indexOf(key) >= 0) continue; if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue; target[key] = source[key]; } } return target; }\n\nfunction _objectWithoutPropertiesLoose(source, excluded) { if (source == null) return {}; var target = {}; var sourceKeys = Object.keys(source); var key, i; for (i = 0; i < sourceKeys.length; i++) { key = sourceKeys[i]; if (excluded.indexOf(key) >= 0) continue; target[key] = source[key]; } return target; }\n\nimport * as React from \"react\";\n\nfunction SvgLibraryBooks(_ref, svgRef) {\n  var title = _ref.title,\n      titleId = _ref.titleId,\n      props = _objectWithoutProperties(_ref, _excluded);\n\n  return /*#__PURE__*/React.createElement(\"svg\", _extends({\n    xmlnsXlink: \"http://www.w3.org/1999/xlink\",\n    id: \"Layer_1\",\n    xmlns: \"http://www.w3.org/2000/svg\",\n    x: \"0px\",\n    y: \"0px\",\n    viewBox: \"0 0 512 512\",\n    style: {\n      enableBackground: \"new 0 0 512 512\"\n    },\n    xmlSpace: \"preserve\",\n    ref: svgRef,\n    \"aria-labelledby\": titleId\n  }, props), title ? /*#__PURE__*/React.createElement(\"title\", {\n    id: titleId\n  }, title) : null, _g || (_g = /*#__PURE__*/React.createElement(\"g\", null, /*#__PURE__*/React.createElement(\"g\", null, /*#__PURE__*/React.createElement(\"path\", {\n    d: \"M378.526,0.363l-98.765,19.765V0H173.658h-31.208H36.35v509.726h106.101h31.208h106.101V189.881L344.221,512       l131.429-26.301L378.526,0.363z M142.451,478.518H67.557v-23.232h74.893V478.518z M142.451,424.078H67.557V31.208h74.893V424.078z        M248.552,478.518h-74.893v-23.232h74.893V478.518z M248.553,424.078h-74.893V31.208h74.348l0.545,2.726V424.078z M283.823,51.14       l70.227-14.054l74.321,371.384l-70.143,14.478L283.823,51.14z M364.351,453.551l70.143-14.478l4.433,22.15l-70.229,14.054       L364.351,453.551z\"\n  })))), _g2 || (_g2 = /*#__PURE__*/React.createElement(\"g\", null, /*#__PURE__*/React.createElement(\"g\", null, /*#__PURE__*/React.createElement(\"rect\", {\n    x: 84.5,\n    y: 63.456,\n    width: 41.61,\n    height: 31.208\n  })))), _g3 || (_g3 = /*#__PURE__*/React.createElement(\"g\", null, /*#__PURE__*/React.createElement(\"g\", null, /*#__PURE__*/React.createElement(\"rect\", {\n    x: 190.617,\n    y: 63.456,\n    width: 41.61,\n    height: 31.208\n  })))), _g4 || (_g4 = /*#__PURE__*/React.createElement(\"g\", null, /*#__PURE__*/React.createElement(\"g\", null, /*#__PURE__*/React.createElement(\"rect\", {\n    x: 308.84,\n    y: 75.683,\n    transform: \"matrix(0.9819 -0.1896 0.1896 0.9819 -11.3402 64.0321)\",\n    width: 40.327,\n    height: 31.209\n  })))), _g5 || (_g5 = /*#__PURE__*/React.createElement(\"g\", null)), _g6 || (_g6 = /*#__PURE__*/React.createElement(\"g\", null)), _g7 || (_g7 = /*#__PURE__*/React.createElement(\"g\", null)), _g8 || (_g8 = /*#__PURE__*/React.createElement(\"g\", null)), _g9 || (_g9 = /*#__PURE__*/React.createElement(\"g\", null)), _g10 || (_g10 = /*#__PURE__*/React.createElement(\"g\", null)), _g11 || (_g11 = /*#__PURE__*/React.createElement(\"g\", null)), _g12 || (_g12 = /*#__PURE__*/React.createElement(\"g\", null)), _g13 || (_g13 = /*#__PURE__*/React.createElement(\"g\", null)), _g14 || (_g14 = /*#__PURE__*/React.createElement(\"g\", null)), _g15 || (_g15 = /*#__PURE__*/React.createElement(\"g\", null)), _g16 || (_g16 = /*#__PURE__*/React.createElement(\"g\", null)), _g17 || (_g17 = /*#__PURE__*/React.createElement(\"g\", null)), _g18 || (_g18 = /*#__PURE__*/React.createElement(\"g\", null)), _g19 || (_g19 = /*#__PURE__*/React.createElement(\"g\", null)));\n}\n\nvar ForwardRef = /*#__PURE__*/React.forwardRef(SvgLibraryBooks);\nexport default __webpack_public_path__ + \"static/media/library-books.edb3e33c.svg\";\nexport { ForwardRef as ReactComponent };","import {Link} from 'react-router-dom';\nimport React, {useCallback} from 'react';\nimport './header.css';\nimport {AiOutlineLeft} from 'react-icons/ai'\nimport {loadSoundfont} from \"../util/instrument\";\n\ninterface Props {\n  title: string;\n  backButton?: boolean;\n  back?: () => void;  //optional callback function for back button in header\n  parentUrl: string;\n}\n\nexport const Header = (props: Props) => {\n  loadSoundfont();\n\n  const goBack = useCallback(() => {\n    if (props.back) {\n      props.back();\n    }else {\n      window.history.back();\n    }\n  }, [props]);\n\n  const {title, backButton} = props;\n  return (\n    <div key='header' className='header'>\n      {backButton &&\n          <Link id='back-button-link' to={props.parentUrl}>\n            <AiOutlineLeft className='backButton' onClick={goBack}/></Link>}\n      <span className='title'>{title}</span>\n      {backButton && <span className='rightSpan'> </span>}\n    </div>\n  )\n}\n","import React from 'react';\nimport './footer.css';\nimport {AiOutlineCalendar, AiOutlineQuestionCircle} from 'react-icons/ai'\nimport {AiOutlineSetting} from 'react-icons/ai'\nimport {ReactComponent as LibraryBooks} from '../assets/library-books.svg';\nimport {Link} from \"react-router-dom\";\n\nexport const Footer = () => {\n  return (\n    <div key='footer' className='footer'>\n      <Link className='link' to='/'>\n        <AiOutlineCalendar className='calendarIcon' />\n      </Link>\n      <Link className='link' to='/library'>\n        <LibraryBooks className='libraryBooksIcon' />\n      </Link>\n      <Link className='link' to='/settings'>\n        <AiOutlineSetting className='settingsIcon' />\n      </Link>\n      <Link className='link' to='/help'>\n        <AiOutlineQuestionCircle className='helpIcon' />\n      </Link>\n    </div>\n  )\n};\n","import { useState, useEffect } from 'react';\n\nfunction getWindowDimensions() {\n  const { innerWidth: width, innerHeight: height } = window;\n  return {\n    width,\n    height\n  };\n}\n\nexport default function useWindowDimensions() {\n  const [windowDimensions, setWindowDimensions] = useState(getWindowDimensions());\n\n  useEffect(() => {\n    function handleResize() {\n      setWindowDimensions(getWindowDimensions());\n    }\n\n    window.addEventListener('resize', handleResize);\n    window.addEventListener('orientationchange', handleResize);\n    return () => window.removeEventListener('resize', handleResize);\n  }, []);\n\n  return windowDimensions;\n}\n","import {useEffect, useState} from \"react\";\nimport './info_page.css'\n\ninterface Props {\n  txtFilePath: string;\n}\n\nexport const InfoPage = (props: Props) => {\n  const {txtFilePath} = props;\n  const [songText, setSongText] = useState('');\n\n  useEffect(() => {\n    fetch(txtFilePath)\n      .then((response) => response.text())\n      .then((data) => {\n        setSongText(data);\n      })\n  }, [txtFilePath]);\n\n  const lines = songText.split('\\n');\n  const author = lines.filter(line => line.startsWith('author')).map(line => line.match(/^[a-z]+\\s+(.*)$/)?.[1]);\n  const composer = lines.filter(line => line.startsWith('composer')).map(line => line.match(/^[a-z]+\\s+(.*)$/)?.[1]);\n  const harmony = lines.filter(line => line.startsWith('harmony')).map(line => line.match(/^[a-z]+\\s+(.*)$/)?.[1]);\n  const copyright = lines.filter(line => line.startsWith('copyright')).map(line => line.match(/^[a-z]+\\s+(.*)$/)?.[1]);\n\n  return (\n    <div className='info'>\n      {author.length > 0 ? (<div><h2>Author</h2>{author}</div>) : ''}\n      {composer.length > 0 ? (<div><h2>Composer</h2>{composer}</div>) : ''}\n      {harmony.length > 0 ? (<div><h2>Harmony</h2>{harmony}</div>) : ''}\n      {copyright.length > 0 ? (<div><h2>Copyright</h2>{copyright}</div>) : ''}\n    </div>\n  );\n}\n","import {useLocation} from 'react-router-dom';\nimport {MidiPlaybackEnvironment} from '../MidiPlaybackEnvironment';\nimport React, {useState} from 'react';\nimport '../shared.css';\nimport {ensureExists, hymnalsPath, hymnalsPDFPath, getHymnFromUrl} from '../shared';\nimport {Header} from \"./header\";\nimport {\n  AiOutlineFileText,\n  AiOutlineInfoCircle,\n  AiOutlineControl,\n  AiFillCloseCircle\n} from \"react-icons/ai\";\nimport './footer.css';\nimport './player_page.css';\nimport {Document, Page} from 'react-pdf';\nimport useWindowDimensions from \"../util/useWindowDimensions\";\nimport {InfoPage} from './info_page';\nimport {Hymn} from './hymns_list';\n\ninterface Props {\n  hymns?: Hymn[];  //optional list of songs to be played\n  back?: () => void;  //optional callback function for back button in header\n  parentUrl: string;  //url for back button link\n}\n\nexport const PlayerPage = (props: Props) => {\n\n  function generateFileName(hymn: Hymn, fileType: string): string {\n    let titleAllCaps = ensureExists(hymn.title).toUpperCase();\n\n    if(titleAllCaps.includes('PSALM')) {\n      return hymn.number + ' - ' + hymn.title + '.' + fileType;\n    }\n    else {\n      if(hymn.psalm) {\n        return hymn.number + ' - ' + hymn.title + ' - ' + hymn.psalm + '.' + fileType;\n      }\n      else {\n        return hymn.number + ' - ' + hymn.title + '.' + fileType;\n      }\n    }\n  }\n\n  function encodeMusicURI(uri: string) {\n    return encodeURIComponent(uri)\n      .replace(/%E2%80%99/g, '%27') // apostrophes are encoded incorrectly\n      .replace(/!/g, '%21');\n  }\n\n  function generatePathFor(hymnalName: string, fileName: string): string {\n    return `${hymnalsPath}/${encodeMusicURI(hymnalName)}/${encodeMusicURI(fileName)}`;\n  }\n\n  const search = useLocation().search;\n  enum Display {PDF, Info, SongSettings}\n  const [display, setDisplay] = useState(Display.SongSettings);\n  const [numPages, setNumPages] = useState<number | undefined>(undefined);\n  const windowDimensions = useWindowDimensions();\n  let hymn: Hymn;\n\n  if (props.hymns) {   //use props if there are any\n    hymn = props.hymns[0];   //just one hymn for now\n  } else {   //else search url\n    hymn = ensureExists(getHymnFromUrl(search));\n  }\n\n  const midiFile = generateFileName(hymn, 'mid');\n  const pdfFile = generateFileName(hymn, 'pdf');\n  const txtFile = generateFileName(hymn, 'txt');\n  const pdfPath = `${hymnalsPDFPath}/${encodeMusicURI(ensureExists(hymn.hymnal))}/${encodeMusicURI(pdfFile)}`;\n  const title = (hymn.number ? hymn.number.toString() + ' - ' : '') + ensureExists(hymn.title);\n\n  function renderPdfDocument() {\n    return <Document\n        file={pdfPath}\n        options={{workerSrc: \"/pdf.worker.js\"}}\n        onLoadSuccess={({numPages}) => setNumPages(numPages)}\n        onLoadError={console.error}\n    >\n      {Array.apply(null, Array(numPages))\n          .map((x, i) => i + 1)\n          .map(page => <Page pageNumber={page} key={page} width={windowDimensions.width}/>)}\n    </Document>;\n  }\n\n  function renderPdf() {\n    return (\n        <div key='pdf' style={{...(display !== Display.PDF && {display: 'none'})}} className='pdfDoc'>\n          <div onClick={() => setDisplay(Display.SongSettings)}><AiFillCloseCircle className='closeButton'/></div>\n          {renderPdfDocument()}\n        </div>\n    );\n  }\n\n  function renderPlayer() {\n    return <div key='player' style={{...(display === Display.PDF && {display: 'none'})}}>\n      <div className='outerPageContent'>\n        <Header\n            title={ensureExists(title)}\n            backButton={true}\n            back={props.back}\n            parentUrl={props.parentUrl}\n        />\n        <div className='innerPageContent'>\n          <div hidden={display !== Display.Info}>\n            <InfoPage txtFilePath={generatePathFor(ensureExists(hymn.hymnal), txtFile)}/>\n          </div>\n          <div hidden={display !== Display.SongSettings}>\n            <MidiPlaybackEnvironment midiFilePath={generatePathFor(ensureExists(hymn.hymnal), midiFile)}/>\n          </div>\n        </div>\n        <div className='footer'>\n          <div onClick={() => setDisplay(Display.SongSettings)}>\n            <AiOutlineControl className='controlsIcon'/>\n          </div>\n          <div onClick={() => setDisplay(Display.PDF)}>\n            <AiOutlineFileText className='pdfIcon'/>\n          </div>\n          <div onClick={() => setDisplay(Display.Info)}>\n            <AiOutlineInfoCircle className='infoIcon'/>\n          </div>\n        </div>\n      </div>\n    </div>;\n  }\n\n  return (\n    <div>\n      {renderPdf()}\n      {renderPlayer()}\n    </div>\n  );\n};\n","import {Link, useLocation} from 'react-router-dom';\nimport '../shared.css';\nimport './hymns_list.css';\nimport React, {useCallback, useEffect, useMemo, useState} from \"react\";\nimport {ensureExists, getHymnFromUrl, hymnalsPath} from \"../shared\";\nimport {Header} from \"./header\";\nimport {Footer} from \"./footer\";\nimport {PlayerPage} from './player_page';\nimport {AiFillCloseCircle} from \"react-icons/ai\";\n\nexport interface ThisWeek {\n  date: string\n  songs : Hymn[]\n}\n\nexport interface Hymnal {\n  name: string;\n  hymns: Hymn[];\n}\n\nexport interface Hymn {\n  number: string;\n  title: string;\n  psalm?: string;\n  hymnal?: string;\n}\n\nexport interface Props {\n  title: string;\n  defaultHymnals?: Hymnal[];\n  collapsed: boolean;\n  parentUrl: string;\n  message?: string;\n}\n\nexport const HymnsList = (props: Props) => {\n  const [expandedHymnals, setExpandedHymnals] = useState([] as string[]);\n  const [searchString, setSearchString] = useState('');\n  const [hymnalNames, setHymnalNames] = useState([] as string[]);\n  const [allHymnals, setAllHymnals] = useState([] as Hymnal[]);\n  const [searchHasFocus, setSearchHasFocus] = useState(false);\n\n  // state var for whether to display player or not, sort of like a boolean but is a Hymn obj\n  // initialize to undefined\n  const [displayHymn, setDisplayHymn] = useState<Hymn | undefined>(undefined);\n  const hymnalsManifest = `${hymnalsPath}/manifest.json`;\n  const hymnalManifest = (hymnalName: string) => `${hymnalsPath}/${hymnalName}/manifest.json`;\n  const search = useLocation().search;\n\n  useEffect(() => {\n    fetch(hymnalsManifest)\n      .then((response) => response.json())\n      .then((data: string[]) => {\n        setHymnalNames(data);\n      })\n  }, [hymnalsManifest]);\n\n  useEffect(() => {\n    Promise.all(hymnalNames.map(hymnalName => fetch(hymnalManifest(hymnalName))))\n      .then((responses) => Promise.all(responses.map(response => response.json())))\n      .then((hymnLists: Hymn[][]) => {\n        setAllHymnals(hymnLists.map((hymns, i) => ({\n          name: hymnalNames[i],\n          hymns,\n        })));\n      })\n  }, [hymnalNames]);\n\n  const searchRegEx = useMemo(() => {\n    //if search string starts with nonAlphaNumeric character(s) chop them off\n    const searchTrimmed = searchString.replace(/^[^a-z\\d']+/, '')\n    const spaceRegEx = `[a-z0-9]*[^a-z0-9']+`\n    const searchTerms = searchTrimmed.replaceAll(/[^a-z\\d']+/g, spaceRegEx)\n    return new RegExp(searchTerms, 'gi')\n  }, [searchString]);\n\n\n  function prependZeros(number: string): string | undefined{\n    switch(number.toString().length) {\n      case 1:\n        return '00' + number;\n      case 2:\n        return '0' + number;\n      case 3:\n        return number.toString();\n    }\n  }\n\n  function generateSongDisplayName(hymn: Hymn) {\n    const number = prependZeros(hymn.number);\n    const psalmSuffix = hymn.psalm && !ensureExists(hymn.title).toLowerCase().includes('psalm') ? ' - ' + hymn.psalm : '';\n    const displayName = number + ' - ' + hymn.title + psalmSuffix;\n\n    const match = displayName.match(searchRegEx)\n\n    const startIndex = displayName.search(searchRegEx)\n    const endIndex = startIndex + (match && match.length ? match[0].length : 0)\n\n    const beforeBold = displayName.slice(0, startIndex)\n    const bold = displayName.slice(startIndex, endIndex)\n    const afterBold = displayName.slice(endIndex, displayName.length)\n\n    return <div>{beforeBold}<b>{bold}</b>{afterBold}</div>\n  }\n\n  const toggleHymnal = (hymnalName: string) => () => {\n    if (!props.collapsed) {\n      return;\n    }\n    if (expandedHymnals.includes(hymnalName)) {\n      setExpandedHymnals(expandedHymnals.filter((name) => name !== hymnalName));\n    } else {\n      setExpandedHymnals([...expandedHymnals, hymnalName]);\n    }\n  };\n\n  function generateUrl(hymnal: Hymnal, hymn: Hymn): string {\n\n    const hymnalName = hymnal.name.replace(/ /g, '_');\n    const hymnTitle = hymn.title.replace(/ /g, '_');\n    const hymnNumber = hymn.number;\n    let psalmName;\n\n    if(hymn.psalm) {\n      psalmName = hymn.psalm.replace(/ /g, '_');\n    } else {\n      psalmName = '';\n    }\n\n    const url: string =\n        props.parentUrl + '?' +\n        'hymnal=' + hymnalName +\n        '&title=' + hymnTitle +\n        '&number=' + hymnNumber +\n        '&psalm=' + psalmName;\n\n    return(url);\n  }\n\n  function generateHTMLTable(hymnal: Hymnal): any {\n    let tableRows = hymnal.hymns\n      .filter((hymn) => {\n      const number = prependZeros(hymn.number);\n      const psalmSuffix = hymn.psalm && !ensureExists(hymn.title).toLowerCase().includes('psalm') ? ' - ' + hymn.psalm : '';\n      const hymnString = number + ' - ' + hymn.title + psalmSuffix;\n      return hymnString.search(searchRegEx) !== -1\n    })\n      .map((hymn) => {\n        const url = generateUrl(hymnal, hymn);\n        return (\n          <tr key={hymn.number + ' ' + hymn.title}>\n            <td className='song'>\n              <Link className='this-week-songs' to={url}\n                    onClick={() => handleClick({\n                      hymnal: hymnal.name,\n                      ...hymn,\n                      number: ensureExists(prependZeros(hymn.number)),\n              })}>\n                {generateSongDisplayName(hymn)}\n              </Link>\n            </td>\n          </tr>\n        )\n      });\n    // show songs for this hymnal if collapsing is disabled, if the current hymnal is expanded,\n    // or if there is a search string and no hymnals are expanded\n    const showSongs = !props.collapsed || expandedHymnals.includes(hymnal.name) ||\n      (searchString && expandedHymnals.length === 0);\n    return (\n      <table className='this-week-table' key={hymnal.name}>\n        <tbody>\n          <tr><th className={`hymnal ${props.collapsed && 'collapsibleHymnal'}`} onClick={toggleHymnal(hymnal.name)}>\n           {hymnal.name}\n          </th></tr>\n        </tbody>\n        {showSongs && <tbody className='this-week-table-body'>{tableRows}</tbody>}\n      </table>\n    )\n  }\n\n  const cancelSearch = () => {\n    setSearchString('');\n  };\n\n  function renderSearchControl() {\n    return (\n      <div key='searchDiv' className='searchDiv'>\n        <input\n          key='search'\n          id='song-search-bar'\n          type='text'\n          placeholder='Search'\n          onChange={(event) => setSearchString((event.target as HTMLInputElement).value)}\n          onFocus={() => setTimeout(() => setSearchHasFocus(true))}\n          onBlur={() => setTimeout(() =>setSearchHasFocus(false))}\n          autoComplete='off'\n          className='searchInput'\n          value={searchString}\n        />\n        {/* Note that the built-in search cancel button does not work on iOS */}\n        <div\n          hidden={!searchHasFocus && searchString === ''}\n          key='cancelSearch'\n          className='cancelSearch'\n          onClick={cancelSearch}\n        >\n          <AiFillCloseCircle className='cancelSearchIcon' />\n        </div>\n      </div>\n    );\n  }\n\n  function renderHymnals() {\n\n    //display list of hymnals/hymns unless user clicks a specific hymn, then show the player\n\n    const hymnals = (searchString !== '' || !props.defaultHymnals) ? allHymnals : props.defaultHymnals;\n    return (\n      <div>\n        <div id='hymnal-div'>{hymnals.map(hymnal => generateHTMLTable(hymnal))}</div>\n      </div>\n    );\n  }\n\n  const back = useCallback(() => {\n    setDisplayHymn(undefined);\n  }, []);\n\n  function handleClick(hymn: Hymn) {\n    setDisplayHymn(hymn);\n  }\n\n  if (!displayHymn) {\n    //if there are search parameters, set state to search param hymn\n    if (getHymnFromUrl(search)) {\n      setDisplayHymn(getHymnFromUrl(search));\n    }\n\n    return (\n      <div key='root' className='outerPageContent'>\n          {searchHasFocus || (searchString !== '') ? undefined : (<Header title={props.title} parentUrl={props.parentUrl} />)}\n          {renderSearchControl()}\n        <div key='inner' className='innerPageContent songList'>\n          {\n            (props.message && !searchHasFocus) ? (\n              <div key='message' className='message'>\n                {props.message}\n              </div>\n            ) : (\n              <div key='innerHymnList'>\n                {renderHymnals()}\n              </div>\n            )\n          }\n        </div>\n        {searchHasFocus || (searchString !== '') ? undefined : (<Footer />)}\n      </div>\n    );\n  } else {\n    return (\n      <PlayerPage hymns={[displayHymn]} back={back} parentUrl={props.parentUrl}/>\n    );\n  }\n}\n","class Settings {\n  get church(): string | undefined {\n    const cookies = document.cookie.split(';');\n    for (const cookie of cookies) {\n      const match = cookie.match(/\\s*church=(?<church>.*)/);\n      if (match && match.groups) {\n        return decodeURI(match.groups['church']);\n      }\n    }\n    return undefined;\n  }\n\n  set church(value) {\n    const date = new Date();\n    date.setTime(date.getTime() + (100*365*24*60*60*1000)); //expires in 100 years\n    document.cookie = 'church=' + (value ? encodeURI(value) : value) + ';';\n    document.cookie = 'expires=' + date.toUTCString() + ';';\n    document.cookie = 'path=/;';\n  }\n}\n\nexport const settings = new Settings();\n","import React, {useEffect, useState} from 'react';\nimport '../shared.css';\nimport {settings} from '../data/settings';\nimport {Header} from './header';\nimport {Footer} from './footer';\nimport './choose_church_page.css';\nimport '../shared.css';\nimport {AiFillCloseCircle} from \"react-icons/ai\";\n\nexport interface Props {\n  onSetChurch(churchName: string): void;\n}\n\nexport const ChooseChurchPage = (props: Props) => {\n  const churchesManifest = process.env.PUBLIC_URL + '/this_week/manifest.json';\n  const [churches, setChurches] = useState([]);\n  const [church, setChurch] = useState(settings.church);\n  const [searchString, setSearchString] = useState('');\n  const [searchHasFocus, setSearchHasFocus] = useState(false);\n\n  function onSetChurch(event: React.MouseEvent<HTMLInputElement>) {\n    const church = event.currentTarget.value;\n    settings.church = church;\n    setChurch(church);\n    if (props.onSetChurch) {\n      setTimeout(() => props.onSetChurch(church), 1000);\n    }\n  }\n\n  useEffect(() => {\n    fetch(churchesManifest)\n      .then((response) => response.json())\n      .then((data) => {\n        setChurches(data);\n      })\n      .catch(function() {\n        throw new Error('Error: HTTP-status 404, could not fetch churches manifest: ' + churchesManifest);\n      });\n  }, [churchesManifest]);\n\n\n\n    const cancelChurchSearch = () => {\n        setSearchString('');\n    };\n\n    function renderChurchSearchControl() {\n        return (\n            <div key='searchDiv' className='searchDiv'>\n                <input\n                    key='search'\n                    id='song-search-bar'\n                    type='text'\n                    placeholder='Search'\n                    onChange={(event) => setSearchString((event.target as HTMLInputElement).value)}\n                    onFocus={() => setTimeout(() => setSearchHasFocus(true))}\n                    onBlur={() => setTimeout(() =>setSearchHasFocus(false))}\n                    autoComplete='off'\n                    className='searchInput'\n                    value={searchString}\n                />\n                {/* Note that the built-in search cancel button does not work on iOS */}\n                <div\n                    hidden={!searchHasFocus && searchString === ''}\n                    key='cancelSearch'\n                    className='cancelSearch'\n                    onClick={cancelChurchSearch}\n                >\n                    <AiFillCloseCircle className='cancelSearchIcon' />\n                </div>\n            </div>\n        );\n    }\n\n  const spaceRegEx = \"[a-z0-9]*[^a-z0-9']+\"\n  const searchTerms = searchString.replaceAll( / +/g, spaceRegEx)\n  const regEx = new RegExp(searchTerms, 'gi')\n  const churchesFiltered = churches.filter((church : string) => church.search(regEx) !== -1)\n\n  const churchesToDisplay = searchString ? churchesFiltered : churches\n  const churchesRendered = churchesToDisplay.map((churchName) =>\n      <div className='church' key={churchName}>\n          <input\n              id='church-input'\n              className='churchRadioButton'\n              type=\"radio\"\n              value={churchName}\n              name=\"church\"\n              defaultChecked={church === churchName}\n              onClick={onSetChurch}\n          />\n          <label id='church-name' className={'churchName' + (church === churchName ? ' selectedChurch' : '')}>\n              {churchName}\n          </label>\n      </div>\n  );\n\n\n  return (\n    <div className='outerPageContent'>\n      <Header title='Choose Church' parentUrl={'settings'}/>\n        {renderChurchSearchControl()}\n      <div className='innerPageContent'>\n        <div className='churches'>\n          {churchesRendered}\n        </div>\n      </div>\n      <Footer />\n    </div>\n  )\n};\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport {HashRouter as Router, Switch, Route} from 'react-router-dom';\nimport './index.css';\nimport {LibraryPage} from './pages/library_page';\nimport {HymnsList} from './pages/hymns_list';\nimport {PlayerPage} from './pages/player_page';\nimport {ChooseChurchPage} from './pages/choose_church_page';\nimport {ThisWeekPage} from \"./pages/this_week_page\";\nimport {HelpPage} from \"./pages/help_page\";\nimport './util/instrument'; // kick off sound font download\n\n/*\nIF YOU MODIFY THE APP VERSIONING SYSTEM IN ANY OF THE FOLLOWING WAYS:\n- change the variable name\n- change the version number to more than one decimal place ('x.y')\n    - 'x.yz'\n    - 'x.y.z'\n    - 'xy.z'\nYOU MUST MODIFY 'test-build.js' LINE 98 AND OR LINE 99 ACCORDINGLY\n*/\n\nlet basename = '/';\nconst unregister = false;\n\nif ('serviceWorker' in navigator) {\n  window.addEventListener('load', function() {\n    if (unregister) {\n      unregisterServiceWorker();\n    } else {\n      registerServiceWorker();\n    }\n  });\n}\n\nfunction registerServiceWorker() {\n  navigator.serviceWorker.register('./service-worker.js')\n    .then(function(registration) {\n      // registration was successful\n      console.log('ServiceWorker registration successful with scope: ', registration.scope);\n    }, function(err) {\n      // registration failed :(\n      console.log('ServiceWorker registration failed: ', err);\n    });\n}\n\nfunction unregisterServiceWorker() {\n  navigator.serviceWorker.getRegistrations().then(function(registrations) {\n    for(let registration of registrations) {\n      registration.unregister()\n    } })\n}\n\nwindow.addEventListener('error', function (event: ErrorEvent) {\n  if (event.error.hasBeenCaught !== undefined) {\n    return false;\n  }\n  event.error.hasBeenCaught = true;\n  const message = {\n    message: event.message,\n    url: event.filename,\n    line: event.lineno,\n    column: event.colno,\n    error: JSON.stringify(event.error)\n  }\n\n  // @ts-ignore\n  if (window.webkit) {\n    // @ts-ignore\n    window.webkit.messageHandlers.error.postMessage(message);\n  } else {\n    console.log(\"Error:\", message);\n  }\n});\n\nReactDOM.render(\n    <Router basename={basename}>\n        <Switch>\n            <Route exact path = '/' component = {ThisWeekPage}/>\n            <Route exact path = '/hymns' component = {HymnsList}/>\n            <Route exact path = '/library' component = {LibraryPage}/>\n            <Route exact path = '/player' component = {PlayerPage}/>\n            <Route exact path = '/settings' component = {ChooseChurchPage}/>\n            <Route exact path = '/help' component = {HelpPage}/>\n        </Switch>\n    </Router>,\n    document.getElementById('root')\n);","import React, {useEffect, useState} from \"react\";\nimport {ChooseChurchPage} from \"./choose_church_page\";\nimport {settings} from \"../data/settings\";\nimport {HymnsList} from \"./hymns_list\";\nimport {Hymn, Hymnal, ThisWeek} from './hymns_list';\nimport '../shared.css';\n\nexport const ThisWeekPage = () => {\n  // todo(hewitt): Remove (temporarily unsets church for testing purposes)\n  // settings.church = '';\n  const thisWeekManifest = process.env.PUBLIC_URL + '/this_week/manifest.json';\n  const [churches, setChurches] = useState([]);\n  const [church, setChurch] = useState<string | undefined>(settings.church);\n  const [hymnals, setHymnals] = useState([] as Hymnal[]);\n  const [downloadFinished, setDownloadFinished] = useState(false);\n  const [sundayDay, setSundayDay] = useState('')\n\n  const thisSundayDate = () => {\n    const today = new Date();\n    const result = today;\n    result.setDate(today.getDate() + (today.getDay() > 0 ? 7 - today.getDay() : 0));\n    const months = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];\n    return `${months[result.getMonth()]} ${result.getDate()}`;\n  };\n\n  useEffect(() => {\n    fetch(thisWeekManifest)\n      .then((response) => response.json())\n      .then((data) => {\n        setChurches(data);\n      })\n      .catch(() => {\n        throw new Error('Error: HTTP-status 404, bad request, could not fetch: ' + thisWeekManifest);\n      });\n  }, [thisWeekManifest]);\n\n  useEffect(() => {\n    if (!church) {\n      return;\n    }\n\n    const churchManifest = process.env.PUBLIC_URL + `/this_week/${church}.json`;\n    fetch(churchManifest)\n      .then((response) => response.json())\n      .then((data: Hymn[]| ThisWeek) => {\n        // TODO: Remove isOldDataFormat related code August 2022\n        function isOldDataFormat(data: Hymn[]| ThisWeek): data is Hymn[] {\n          return !('date' in data)\n        }\n        if (isOldDataFormat(data)) {\n          const uniqueHymnalNames = Array.from(new Set(data\n            .filter(hymn => hymn.hymnal)\n            .map(hymn => hymn.hymnal)\n          )) as string[];\n          const hymnals = uniqueHymnalNames.map(hymnalName => ({\n            name: hymnalName,\n            hymns: data.filter(hymn => hymn.hymnal === hymnalName),\n          }));\n          setHymnals(hymnals);\n          setSundayDay(thisSundayDate())\n          setDownloadFinished(true);\n        } else {\n          const {date, songs} = data;\n          setSundayDay(date)\n          const uniqueHymnalNames = Array.from(new Set(songs\n            .filter(hymn => hymn.hymnal)\n            .map(hymn => hymn.hymnal)\n          )) as string[];\n          const hymnals = uniqueHymnalNames.map(hymnalName => ({\n            name: hymnalName,\n            hymns: songs.filter(hymn => hymn.hymnal === hymnalName),\n          }));\n          setHymnals(hymnals);\n          setDownloadFinished(true);\n        }\n      })\n  }, [church]);\n\n  if (churches) {\n    if (church) {  //church selected, display this week songs\n      let message: string | undefined;\n\n      if(!downloadFinished) {\n        message = 'Downloading songs for this week...';\n      } else {\n        if (hymnals.length === 0) {\n          message = 'Your music director has not yet added any songs for this week.';\n        } else {\n          message = undefined;\n        }\n      }\n      return (\n          <HymnsList\n              title={churches ? `Songs for ${sundayDay}` : 'Library'}\n              defaultHymnals={churches ? hymnals : undefined}\n              collapsed={false}\n              parentUrl={''}\n              message={message}\n          />\n      );\n    } else {  //no church selected, display choose church\n      return (\n          <ChooseChurchPage onSetChurch={setChurch}/>\n      );\n    }\n  } else {\n    throw new Error('no churches manifest found') ;\n  }\n};\n","import React from 'react';\nimport '../shared.css';\nimport {HymnsList} from \"./hymns_list\";\nimport './library_page.css';\n\nexport const LibraryPage = () => {\n  return (<HymnsList\n      title='Library'\n      collapsed={true}\n      parentUrl={'library'} />);\n};\n","import {Header} from \"./header\";\nimport {Footer} from \"./footer\";\nimport React from \"react\";\nimport './help_page.css'\n\nexport const HelpPage = () => {\n  return (\n    <div className='outerPageContent'>\n      <Header title='Help' parentUrl={'help'}/>\n      <div className='innerPageContent'>\n        <div className='content'>\n          <h2>Time Commitment</h2>\n          Learning to sing your part only takes 5-10 minutes per day.  But, to make progress, you need to be\n          consistent.  Find a time of day where you will remember to practice.  Choose a single, relatively easy\n          song to start with.  As a suggestion, you can start with Amazing Grace or Be Thou My Vision.<br/>\n          <br/>\n          Do not expect overnight results!  It might take a couple of months to master your first song.  However,\n          the second song will take less time, and the more you do it, the faster you will be able to acquire\n          new songs!\n          <h2>Voice Range</h2>\n          To learn to sing your part, you must first determine your voice range (soprano, alto, tenor, bass).\n          Ask a musical friend to help you figure this out.<br/>\n          <br/>\n          <h2>Matching Pitch</h2>\n          Once you know which part God designed you to sing, you now need to learn to match pitch.\n          This app does not currently help you to do that, though it hopefully will soon.  If you have\n          access to a piano, you can press a key in your voice range and practice humming the same note.<br/>\n          <br/>\n          <h2>Singing</h2>\n          To learn your part, start by turning up your part (e.g. tenor) and turning down all the other parts.\n          Once you feel confident about singing your part, slowly begin to turn up the melody (usualy soprano).<br/>\n          <br/>\n          This will be challenging because once you hear the melody, you might be inclined to sing that instead\n          of your part.  Keep the melody quiet enough that you can still sing your part.  As you gain\n          confidence, slowly turn up the melody louder and louder.<br/>\n          <br/>\n          When the melody is at full strength and you can still sing you part, congratulations - you are doing\n          very well!  Unfortunately, you are not quite there yet.  This is because in a church setting\n          you will often have trouble hearing your part while everyone around you is singing the melody.<br/>\n          <br/>\n          The final step is to begin turning down your own part with the melody still at full volume.  When you\n          can turn you part down so that it is barely audible and still sing against the melody, you now have\n          a chance at singing in a group.  However, bear in mind that it still takes time.  For me, it took\n          several weeks to learn to match pitch, and then several months before I was able to sing my part\n          in a group.  Stick with it, though, you will eventually be able to sing your part with confidence\n          in a group setting!\n          <h2>Churches</h2>\n          If your church is not in the list, ask your music\n          leader send an email to <a href='mailto:support@crescendosw.com'>support@crescendosw.com</a> with a\n          request to add your church. They will need to be willing to add their song list every week,\n          but that should take them less than five minutes once they get the hang of it.  There is\n          no charge for this service.<br/>\n          <br/>\n          If your weekly song list is empty, talk to your music leader about adding songs each week so that\n          you can practice ahead of Sunday worship.  Remember that we are coming to sing praise to our creator\n          who made us with excellence!  Shouldn't we strive for excellence in our praise to Him!\n          <h2>Feedback</h2>\n          If you have questions, comments, or feedback about the app, please send an email\n          to <a href='mailto:support@crescendosw.com'>support@crescendosw.com</a>.\n        </div>\n      </div>\n      <Footer />\n    </div>\n  )\n}\n"],"sourceRoot":""}